ğŸ“Œ ìƒì†ê´€ê³„ì˜ ë§¤í•‘
-
* ê´€ê³„í˜• DBëŠ” ìƒì† ê´€ê³„ë¼ëŠ” ê°œë…ì´ ì—†ìŒ 
* ìŠˆí¼ íƒ€ì…ê³¼ ì„œë¸Œíƒ€ì…ì´ ê°ì²´ì˜ ìƒì†ì˜ ê°œë…ê³¼ ë¹„ìŠ·í•˜ê¸´ í•¨ 
* ë”°ë¼ì„œ ìƒì†ì€ ìŠˆí¼ íƒ€ì…ê³¼ ì„œë¸Œ íƒ€ì…ì˜ ê´€ê³„ë¥¼ ìƒì† ê´€ê³„ë¡œ ì‚¬ìš©í•˜ê³  ìˆìŒ

> DBì—ì„œ ìŠˆí¼íƒ€ì…ê³¼ ì„œë¸Œíƒ€ì… ëª¨ì‹ë„

![default](./img/804b9698598a4698ad4e6289d6481b13.png)

> ìŠˆí¼íƒ€ì…ê³¼ ì„œë¸Œíƒ€ì…ì„ ë‚˜íƒ€ë‚´ëŠ” ì „ëµ

3ê°€ì§€ ì „ëµì´ ì¡´ì¬
* join ì „ëµ
    * ê³µí†µì˜ í•„ë“œëŠ” ë³„ë„ì˜ í…Œì´ë¸”ì— ëª¨ì•„ë‘ê³ , Dtypeìœ¼ë¡œ ì‹ë³„í•œë‹¤. 
    * ì„œë¸Œíƒ€ì… í…Œì´ë¸”ì— ìŠˆí„°íƒ€ì…ì— ëŒ€í•œ fk ì¡´ì¬
    ![default](./img/57199826a88c4ca0982d3ccaf5deccb6.png)
    
* ë‹¨ì¼ í…Œì´ë¸” ì „ëµ
    * í•˜ë‚˜ì˜ í…Œì´ë¸”ì— ëª¨ë“  ê°’ì„ ë‘ê³  Dtype í•˜ë‚˜ë§Œìœ¼ë¡œ ê°ì²´ë¥¼ ì‹ë³„í•˜ëŠ” ë°©ë²•
    ![default](./img/cace76db1a9846f0ab1e656e7e1497b9.png)
    
* êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ í…Œì´ë¸” ì „ëµ
    * ì„œë¸Œíƒ€ì… 1ê°œ ë§ˆë‹¤ í•˜ë‚˜ì˜ í…Œì´ë¸”ì„ ë§Œë“œëŠ” ì „ëµ
    ![default](./img/f04316ef9e8744e4aa0cb92816f70a82.png)
    * ì‹œí€€ìŠ¤ëŠ” 1ê°œë¥¼ ëŒë ¤ì„œ ì‚¬ìš©í•œë‹¤. 

> ì „ëµ êµ¬í˜„ ë°©ë²• (ì–´ë…¸í…Œì´ì…˜)
* @inheritance(strategy=InheritanceType.XXXX) : í´ë˜ìŠ¤ ìœ„ì— ì‚¬ìš©
    * JOINED : ì¡°ì¸ ì „ëµ
    * SINGLE_TABLE : ë‹¨ì¼ í…Œì´ë¸” ì „ëµ
    * TABLE_PER_CLASS : êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ í…Œì´ë¸” ì „ëµ
* @DiscriminatorColumn(name = "DTYPE") : í´ë˜ìŠ¤ ìœ„ì— ì‚¬ìš© (DTYPE êµ¬ë¶„ì´ í•„ìš”í•œë°, ì´ë¦„ì„ ë³€ê²½í•˜ê³  ì‹¶ì€ ê²½ìš°)
* @DiscriminatorValue("XXX") : DTYPE ë‚´ë¶€ì— ë“¤ì–´ê°ˆ ê°’ì„ ëª…ì‹œí•˜ê³  ì‹¶ì€ ê²½ìš° ì‚¬ìš© (ê¸°ë³¸ : í…Œì´ë¸” ì´ë¦„)


* ì¡°ì¸ ì „ëµ : [Run.java](./join/Run.java)
    * book ì— ê°’ì„ ì €ì¥í•´ë„ itemì— ì €ì¥ ë¨
    ![default](./img/c74430875b024d9f9927a5209738686a.png)
    * ë¹„ì§€ë‹ˆìŠ¤ ì ìœ¼ë¡œ ë§ì´ ì‚¬ìš©í•  ê²½ìš° ì¡°ì¸ ì „ëµì„ êµ¬ì‚¬í•˜ë©´ ì¢‹ìŒ
    * í…Œì´ë¸”ì´ ë‘ê°œë¡œ ë‚˜ë‰˜ì–´ ìˆìŒì„ ì•Œ ìˆ˜ ìˆìŒ
    * ì´ë•Œ book ì€ pkê°€ fk ì„ì„ ì•Œ ìˆ˜ ìˆë‹¤.
    * DTYPEì„ ì‚¬ìš©í•˜ê³  ì‹¶ì€ ê²½ìš° @DiscriminatorColumn íƒœê·¸ë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ë¨ (ì´ëŠ” ìš´ì˜ì—ì„œ ì–´ë–¤ í…Œì´ë¸”ì˜ ë°ì´í„°ì— ì˜í•´ INSERT ë˜ì—ˆëŠ”ì§€ ì•Œê¸° ìœ„í•´ì„œ ë„£ì–´ì£¼ëŠ” ê²ƒì´ ì¢‹ìŒ)
    * ì¥ì  
        * í…Œì´ë¸”ì— ê°’ì´ ì •ê·œí™” ë˜ì–´ ë“¤ì–´ê°€ ìˆìŒ => ì²´ê³„ì ìœ¼ë¡œ ì •ë¦¬ê°€ ì˜ ëœ ë°ì´í„°
        * ì™¸ë˜í‚¤ ì°¸ì¡° ë¬´ê²°ì„± ì œì•½ì¡°ê±´ì„ í™œìš©í•  ìˆ˜ ìˆìŒ (NULL X, ìœ íš¨í•œ ë°ì´í„°)
        * ì €ì¥ ê³µê°„ì˜ íš¨ìœ¨ì„± => ì´ ë§Œí¼ ì„±ëŠ¥ì€ ë†’ì•„ì§
    * ë‹¨ì 
        * ì¡°ì¸ì„ ë§ì´ ì‚¬ìš©í•˜ëŠ” ì ì€ ì˜¤íˆë ¤ ì„±ëŠ¥ì„ ë–¨ì–´íŠ¸ë¦´ ìˆ˜ ìˆìŒ => ê·¸ëŸ¬ë‚˜ ì¡°ì¸ìœ¼ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜ëŠ” ê·¸ë‹¥ í¬ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
        * ì¡°íšŒ ì¿¼ë¦¬ê°€ ë³µì¡í•˜ë‹¤.
        * ë°ì´í„° ì €ì¥ì‹œ INSERT 2ë²ˆ í˜¸ì¶œ => ê·¸ë‹¥ í° ë‹¨ì ì€ ì•„ë‹˜

* ë‹¨ì¼ í…Œì´ë¸” ì „ëµ : [Run.java](./join/Run.java)
    * @Inheritance(strategy = InheritanceType.SINGLE_TABLE) 
    ![default](./img/bff2020cdae14376b8165ac0b826dbfc.png)
    * ë³´ë©´ itemì„ ìƒì† ë°›ì€ movie ì˜ í•„ë“œì¸ directorëŠ” ë¹„ì–´ìˆê³ , DTYPEì€ DiscriminatorColumn ì´ ì—†ìŒì—ë„ ê¸°ë³¸ì ìœ¼ë¡œ ë“¤ì–´ê°€ìˆë‹¤.
        * ë°ì´í„°ë¥¼ êµ¬ë¶„í•  ìˆ˜ ìˆëŠ” ìœ ì¼í•œ ì»¬ëŸ¼ì´ DTYPE ì´ê¸° ë•Œë¬¸ì´ë‹¤.
    * ê·¸ë¦¬ê³  í…Œì´ë¸”ì€ item í•˜ë‚˜ë§Œ ìƒê²¼ìŒì„ ì•Œ ìˆ˜ ìˆë‹¤. 
    * í•œí¸ itemì€ ë‹¨ë…ìœ¼ë¡œ ì‚¬ìš©í•  ì¼ì´ ì—†ë‹¤ë©´ abstract ë¡œ ì¶”ìƒ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ì£¼ëŠ” ê²ƒì´ ë§ë‹¤.
    * movie entity ì— ê°’ì„ insert í•  ë•Œ movie ì— ê°’ì´ ë“¤ì–´ê°€ ìˆëŠ” ê²ƒì´ íŠ¹ì§•ì ì´ë‹¤.
    * ì¡°ì¸ í…Œì´ë¸” ì „ëµê³¼ ë¹„êµ í–ˆì„ ë•Œ ì–´ë…¸í…Œì´ì…˜ í•˜ë‚˜ë§Œ ë°”ë€Œì—ˆì„ ë¿ì¸ë° ë™ì‘ì„ í•œë‹¤ëŠ” ê²ƒì´ íŠ¹ì§•ì ì´ë‹¤.
    * ì¥ì 
        * ì¡°ì¸ì´ ì ì–´ ì„±ëŠ¥ì´ ë¹„êµì  ì¢‹ìŒ 
        * ì¡°íšŒ ì¿¼ë¦¬ê°€ ë‹¨ìˆœí•˜ë‹¤.
    * ë‹¨ì  
        * ì§€ì‹ ì—”í‹°í‹°ê°€ ë§¤í•‘í•œ ì»¬ëŸ¼ì€ ëª¨ë‘ null ì„ í—ˆìš©í•´ì£¼ì–´ì•¼ í•¨
        * ë‹¨ì¼ í…Œì´ë¸”ì— ëª¨ë“  ê²ƒì„ ì €ì¥í•˜ê¸° ë•Œë¬¸ì— í…Œì´ë¸”ì´ ì»¤ì§ˆ ìˆ˜ ìˆìŒ. ìƒí™©ì— ë”°ë¼ì„œ ì¡°íšŒ ì„±ëŠ¥ì´ ì˜¤íˆë ¤ ëŠë ¤ì§ˆ ìˆ˜ ìˆìŒ(ê·¸ëŸ°ë° ì„ê³„ì ì„ ë„˜ì„ì¼ì´ ë§ì§€ ì•ŠìŒ)

* êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ ì „ëµ : [Run.java](./per/Run.java)
    * @Inheritance(strategy = InheritanceType.TABLE_PER_CLASS) 
    ![default](./img/76dc053be8144d8cbfc8723e7476cfc0.png)
    * item ì„ ì‚¬ìš©í• ì¼ì´ ì—†ê¸° ë•Œë¬¸ì— ë¬´ì¡°ê±´ abstract ë¡œ í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. => ê·¸ë ‡ì§€ ì•Šì„ ê²½ìš° í…Œì´ë¸”ì´ ìƒê¹€
    * ê·¸ë¦¬ê³  ê°ì²´ ì§€í–¥ì´ê¸° ë•Œë¬¸ì— item ìœ¼ë¡œ ë°›ì„ ìˆ˜ ìˆì–´ì•¼ í•˜ëŠ”ë° ì´ê²ƒìœ¼ë¡œ ë°›ìœ¼ë©´ ì•„ë˜ì™€ ê°™ì´ ëª¨ë“  í…Œì´ë¸”ì„ unionìœ¼ë¡œ ì „ë¶€ ë’¤ì§„ë‹¤.
    ```sql
        select
            pitem0_.id as id1_7_0_,
            pitem0_.name as name2_7_0_,
            pitem0_.price as price3_7_0_,
            pitem0_.author as author1_6_0_,
            pitem0_.director as director1_8_0_,
            pitem0_.clazz_ as clazz_0_ 
        from
            ( select
                id,
                name,
                price,
                null as author,
                null as director,
                0 as clazz_ 
            from
                PItem 
            union
            all select
                id,
                name,
                price,
                author,
                null as director,
                1 as clazz_ 
            from
                PBook 
            union
            all select
                id,
                name,
                price,
                null as author,
                director,
                2 as clazz_ 
            from
                PMovie 
        ) pitem0_ 
    where
        pitem0_.id=?
    6ì›” 22, 2021 2:38:57 ì˜¤í›„ org.hibernate.engine.jdbc.connections.internal.DriverManagerConnectionProviderImpl stop
    INFO: HHH10001008: Cleaning up connection pool [jdbc:h2:tcp://localhost/~/test]
    
    Process finished with exit code 0
    ```
    * ì¥ì 
        * sub íƒ€ì…ì„ ëª…í™•í•˜ê²Œ êµ¬ë¶„í•˜ì—¬ì•¼ í•  ë•Œë§Œ íš¨ê³¼ì 
        * not null ì¡°ê±´ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
    * ë‹¨ì 
        * ì—¬ëŸ¬ ìì‹ í…Œì´ë¸”ì„ í•¨ê»˜ ì¡°íšŒí•  ë•Œ ì„±ëŠ¥ì´ ëŠë¦¼
        * ìì‹ í…Œì´ë¸”ì„ í†µí•©í•´ì„œ í•˜ë‚˜ë¡œ ë¬¶ì–´ì•¼ í•  ë¶€ë¶„ì´ ìˆì„ ë•Œ ì‚¬ìš©ì´ ì¢‹ì§€ ì•ŠìŒ 
        * ë³€ê²½ì˜ ê´€ì ì—ì„œ ìˆ˜ì •ì´ ì¼ì–´ë‚  ë•Œ ëœ¯ì–´ ê³ ì³ì•¼ í•  ë¶€ë¶„ì´ ë§ìŒ 
    * ì‹¤ë¬´ì—ì„  ì‚¬ìš©í•´ì„  ì•ˆëœë‹¤.


<br/>

ğŸ“Œ ê³µí†µ í•„ë“œ ë¬¶ê¸° (ìƒì† ì´ìš© X)
-
* í…Œì´ë¸”ì—ëŠ” ìˆ˜ì •ì, ìƒì„±ì, ìƒì„±ì¼, ìˆ˜ì •ì¼ ê°™ì€ í•„ë“œë¥¼ ê³µí†µì ìœ¼ë¡œ ê°€ì ¸ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ë§ìŒ. í•´ë‹¹ í•„ë“œë¥¼ í•œ í´ë˜ìŠ¤ì— ë‘ê³  ìƒì†í•´ì„œ ë¬¼ë ¤ ë°›ëŠ” í˜•ì‹ìœ¼ë¡œ êµ¬í˜„í•  ìˆ˜ ìˆëŠ”ë° ì´ ë•Œ ë¶€ëª¨í´ë˜ìŠ¤ëŠ” @MappedSuperclass ìœ¼ë¡œ ì„ ì–¸ëœ í´ë˜ìŠ¤ì´ì—¬ì•¼ í•œë‹¤.
* ìƒì† ë°›ì„ í•„ë“œê°€ ìˆëŠ” í´ë˜ìŠ¤ì— @MappedSuperclass ì–´ë…¸í…Œì´ì…˜ì„ ë‘ê³  MItem ì—ì„œ ìƒì† ë°›ìœ¼ë©´ ë©ë‹ˆë‹¤.
* ê·¸ë¦¬ê³  ì´ë•Œ @MappedSuperclass ë¡œ ì„ ì–¸ëœ í´ë˜ìŠ¤ëŠ” ë˜ë„ë¡ abstract ìœ¼ë¡œ ì„ ì–¸í•´ì„œ ì‚¬ìš©í•˜ì => ê°œë°œì ì‹¤ìˆ˜ ë°©ì§€ ìš©ë„

![default](./img/1b80723a7b9944c19c3063cb513ec555.png)

![default](./img/27b8ff92cc3d46e589b2f10784d3d463.png)
* [MItem.java](./mapped/MItem.java)
* ë³´í†µ ìœ„ì— ë“¤ì–´ê°€ëŠ” í•„ë“œ ê°’ì€ interceptor ë‚˜ event ë“±ìœ¼ë¡œ ê°’ì„ setting í•´ì£¼ê³¤ í•œë‹¤.
* ìƒì†ê´€ê³„ ë§¤í•‘ì´ ì•„ë‹™ë‹ˆë‹¤.
* ì—”í‹°í‹°ê°€ ì•„ë‹™ë‹ˆë‹¤. í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ì§€ë„ ì•ŠìŠµë‹ˆë‹¤.
* ì´ í´ë˜ìŠ¤ë¥¼ ìƒì† ë°›ëŠ” ìì‹ í´ë˜ìŠ¤ì— ë©”í•‘ ì •ë³´ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.
* ì¡°íšŒ, ê²€ìƒ‰ ë¶ˆê°€(em.find(BaseEntity) ë¶ˆê°€)
* ê³µí†µ ì •ë³´ë¥¼ ëª¨ì„ ë•Œë§Œ ì‚¬ìš©

<br/>

ğŸ“Œ ì •ë¦¬
-
* Entity ê°€ ìƒì† ë°›ì„ ìˆ˜ ìˆëŠ” í´ë˜ìŠ¤ëŠ” @MappedSuperclass ë˜ëŠ” @Entity í´ë˜ìŠ¤ ë°–ì— ì—†ë‹¤.



<br/>

ğŸ“Œ ì‹¤ì „ ìš”êµ¬ì‚¬í•­
-
![default](./img/617f71c3460047e1a7ac9542128cc4e5.png)
* í™•ì¥ ë  ìˆ˜ ë•Œë¬¸ì— ì¡°ì¸ ì „ëµìœ¼ë¡œ ìƒì† ë°›ëŠ”ê²Œ ì¢‹ì§€ë§Œ, ì‹¬í”Œí•¨ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ì„œ ë‹¨ì¼ í…Œì´ë¸” ì „ëµìœ¼ë¡œ êµ¬í˜„í•œë‹¤.
* ì•„ë˜ ìš”êµ¬ ì‚¬í•­ì€ MappedSupperclass ê°€ í•„ìš”í•  ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤. 

> ë„ë©”ì¸ ëª¨ë¸

![default](./img/4da3e1e5dcb84348a80210dde8ea46ca.png)

> í…Œì´ë¸” ì„¤ê³„

![default](./img/96efd0c21b1846b1a6419eac99904eee.png)
* item í…Œì´ë¸”ë§Œ ë‹¨ë…ìœ¼ë¡œ ì‚¬ìš©í•  ì¼ì´ ì—†ê¸° ë•Œë¬¸ì— ì•„ë˜ì™€ ê°™ì´ abstractë¡œ  ì¶”ìƒ í´ë˜ìŠ¤ë¡œ ë³€ê²½í•´ì£¼ì—ˆë‹¤. 

![default](./img/787627ddda0a40bc9bc01f22fe57aa9a.png)
* movieë‚˜ album ë“±ì˜ í…Œì´ë¸”ì€ ì—†ê³ , itemì— ëª¨ë“  í•„ë“œê°€ ë‹¤ ìˆëŠ”ë° DType ë˜í•œ ìˆë‹¤. ê·¸ë¦¬ê³  createAt ê°™ì€ BaseEntityì˜ í•„ë“œê°€ ë“¤ì–´ìˆë‹¤.
